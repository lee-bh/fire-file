<html>
    <head>
        <title>Firebase</title>
    </head>
    <body>
        <h1>Firebase</h1>
        <div id="fileList"></div>
        <input type="file" id="fileInput" />
        <button id="uploadButton">Upload</button>
        <div id="progressBar"></div>
        <div id="status"></div>
        <div id="result"></div>
    </body>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-analytics.js";
        import { getFirestore, collection, getDocs, query, orderBy, setDoc, doc } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-firestore.js";
        import { getStorage, ref, uploadBytesResumable } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-storage.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyAPOVR2uHxhyB4JMYKiBF3BxXpCqFVCDEk",
          authDomain: "bh-board.firebaseapp.com",
          projectId: "bh-board",
          storageBucket: "bh-board.firebasestorage.app",
          messagingSenderId: "270894753216",
          appId: "1:270894753216:web:2cec086dd36b2e00d2d425",
          measurementId: "G-9T1QNWK28P"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);

        const storage = getStorage(app);
        const storageRef = ref(storage, 'images');
        const uploadButton = document.getElementById('uploadButton');
        const fileInput = document.getElementById('fileInput');
        const progressBar = document.getElementById('progressBar');
        const status = document.getElementById('status');
        const result = document.getElementById('result');

        window.onload = getFileList;
        async function getFileList() {
            const fileList = document.getElementById('fileList');
            const snapshot = await getDocs(collection(db, 'images'));
            snapshot.forEach(doc => {
                
                const fileItem = document.createElement('div');
                const img = document.createElement('img');
                img.src = doc.data().url;
                img.classList.add('file-img');
                fileItem.appendChild(img);
                const name = document.createElement('div');
                name.textContent = doc.data().name;
                name.classList.add('file-name');
                fileItem.appendChild(name);
                fileList.appendChild(fileItem);
            });
        }

        uploadButton.addEventListener('click', uploadFile);
        function uploadFile() {
            const fileName = fileInput.files[0].name;
            addFileToDB(fileName);
            const fileRef = ref(storage, `images/${fileName}`);
            const uploadTask = uploadBytesResumable(fileRef, fileInput.files[0]);
            uploadTask.on('state_changed', (snapshot) => {
                const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                progressBar.value = progress;
            }, (error) => {
                console.error(error);
            }, () => {
                console.log('Upload complete');
            });
        }

        function addFileToDB(fileName) {
            const fileRef = ref(storage, `images/${fileName}`);
            const snapshot = doc(db, 'images', fileName);
            setDoc(snapshot, {
                name: fileName,
                url: fileRef.fullPath
            });
            console.log('File added to DB');
        }
     
      </script>
</html>